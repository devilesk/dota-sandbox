var heroAliases = {
    "npc_dota_hero_winter_wyvern": {
        "name": "Winter Wyvern",
        "aliases": ["ww", "wyvern"]
    },
    "npc_dota_hero_mirana": {
        "name": "Mirana",
        "aliases": ["potm"]
    },
    "npc_dota_hero_batrider": {
        "name": "Batrider",
        "aliases": ["br"]
    },
    "npc_dota_hero_oracle": {
        "name": "Oracle",
        "aliases": ["ora"]
    },
    "npc_dota_hero_sven": {
        "name": "Sven",
        "aliases": []
    },
    "npc_dota_hero_shadow_demon": {
        "name": "Shadow Demon",
        "aliases": ["sd"]
    },
    "npc_dota_hero_enigma": {
        "name": "Enigma",
        "aliases": []
    },
    "npc_dota_hero_skywrath_mage": {
        "name": "Skywrath Mage",
        "aliases": ["swm", "sky"]
    },
    "npc_dota_hero_skeleton_king": {
        "name": "Wraith King",
        "aliases": ["sk", "snk", "wk", "skeleton", "skeleton king"]
    },
    "npc_dota_hero_weaver": {
        "name": "Weaver",
        "aliases": []
    },
    "npc_dota_hero_naga_siren": {
        "name": "Naga Siren",
        "aliases": ["naga"]
    },
    "npc_dota_hero_doom_bringer": {
        "name": "Doom",
        "aliases": ["db"]
    },
    "npc_dota_hero_treant": {
        "name": "Treant Protector",
        "aliases": ["tree"]
    },
    "npc_dota_hero_venomancer": {
        "name": "Venomancer",
        "aliases": []
    },
    "npc_dota_hero_wisp": {
        "name": "Io",
        "aliases": ["wisp"]
    },
    "npc_dota_hero_ursa": {
        "name": "Ursa",
        "aliases": []
    },
    "npc_dota_hero_huskar": {
        "name": "Huskar",
        "aliases": []
    },
    "npc_dota_hero_bounty_hunter": {
        "name": "Bounty Hunter",
        "aliases": ["bh"]
    },
    "npc_dota_hero_elder_titan": {
        "name": "Elder Titan",
        "aliases": ["tc", "cairne"]
    },
    "npc_dota_hero_templar_assassin": {
        "name": "Templar Assassin",
        "aliases": ["ta", "lanaya"]
    },
    "npc_dota_hero_death_prophet": {
        "name": "Death Prophet",
        "aliases": ["dp", "prophet"]
    },
    "npc_dota_hero_drow_ranger": {
        "name": "Drow Ranger",
        "aliases": ["traxex"]
    },
    "npc_dota_hero_obsidian_destroyer": {
        "name": "Outworld Devourer",
        "aliases": ["od"]
    },
    "npc_dota_hero_nevermore": {
        "name": "Shadow Fiend",
        "aliases": ["sf", "nevermore"]
    },
    "npc_dota_hero_pugna": {
        "name": "Pugna",
        "aliases": []
    },
    "npc_dota_hero_lycan": {
        "name": "Lycan",
        "aliases": []
    },
    "npc_dota_hero_life_stealer": {
        "name": "Lifestealer",
        "aliases": ["naix", "n'aix", "ls"]
    },
    "npc_dota_hero_morphling": {
        "name": "Morphling",
        "aliases": []
    },
    "npc_dota_hero_shredder": {
        "name": "Timbersaw",
        "aliases": ["rizzrack", "shredder", "timbersaw"]
    },
    "npc_dota_hero_leshrac": {
        "name": "Leshrac",
        "aliases": []
    },
    "npc_dota_hero_antimage": {
        "name": "Anti-Mage",
        "aliases": ["am", "magina"]
    },
    "npc_dota_hero_vengefulspirit": {
        "name": "Vengeful Spirit",
        "aliases": ["vs"]
    },
    "npc_dota_hero_medusa": {
        "name": "Medusa",
        "aliases": ["medusa", "gorgon", "dusa"]
    },
    "npc_dota_hero_razor": {
        "name": "Razor",
        "aliases": []
    },
    "npc_dota_hero_tiny": {
        "name": "Tiny",
        "aliases": []
    },
    "npc_dota_hero_tidehunter": {
        "name": "Tidehunter",
        "aliases": []
    },
    "npc_dota_hero_bloodseeker": {
        "name": "Bloodseeker",
        "aliases": ["bs"]
    },
    "npc_dota_hero_undying": {
        "name": "Undying",
        "aliases": ["dirge"]
    },
    "npc_dota_hero_shadow_shaman": {
        "name": "Shadow Shaman",
        "aliases": ["ss"]
    },
    "npc_dota_hero_bane": {
        "name": "Bane",
        "aliases": []
    },
    "npc_dota_hero_lone_druid": {
        "name": "Lone Druid",
        "aliases": ["ld"]
    },
    "npc_dota_hero_centaur": {
        "name": "Centaur Warrunner",
        "aliases": ["centaur"]
    },
    "npc_dota_hero_keeper_of_the_light": {
        "name": "Keeper of the Light",
        "aliases": ["keeper", "ezalor", "kotl"]
    },
    "npc_dota_hero_enchantress": {
        "name": "Enchantress",
        "aliases": []
    },
    "npc_dota_hero_rubick": {
        "name": "Rubick",
        "aliases": ["rubick"]
    },
    "npc_dota_hero_necrolyte": {
        "name": "Necrophos",
        "aliases": ["necrolyte"]
    },
    "npc_dota_hero_magnataur": {
        "name": "Magnus",
        "aliases": ["magnataur", "magnus"]
    },
    "npc_dota_hero_legion_commander": {
        "name": "Legion Commander",
        "aliases": ["tresdin", "legion", "lc"]
    },
    "npc_dota_hero_tinker": {
        "name": "Tinker",
        "aliases": []
    },
    "npc_dota_hero_sniper": {
        "name": "Sniper",
        "aliases": []
    },
    "npc_dota_hero_lich": {
        "name": "Lich",
        "aliases": []
    },
    "npc_dota_hero_puck": {
        "name": "Puck",
        "aliases": []
    },
    "npc_dota_hero_invoker": {
        "name": "Invoker",
        "aliases": ["carl", "kael"]
    },
    "npc_dota_hero_dark_seer": {
        "name": "Dark Seer",
        "aliases": ["ds"]
    },
    "npc_dota_hero_rattletrap": {
        "name": "Clockwerk",
        "aliases": ["rattletrap", "cw"]
    },
    "npc_dota_hero_lion": {
        "name": "Lion",
        "aliases": []
    },
    "npc_dota_hero_kunkka": {
        "name": "Kunkka",
        "aliases": []
    },
    "npc_dota_hero_arc_warden": {
        "name": "Arc Warden",
        "aliases": ["zet"]
    },
    "npc_dota_hero_nyx_assassin": {
        "name": "Nyx Assassin",
        "aliases": ["nerubian", "na"]
    },
    "npc_dota_hero_brewmaster": {
        "name": "Brewmaster",
        "aliases": ["bm"]
    },
    "npc_dota_hero_viper": {
        "name": "Viper",
        "aliases": []
    },
    "npc_dota_hero_luna": {
        "name": "Luna",
        "aliases": []
    },
    "npc_dota_hero_meepo": {
        "name": "Meepo",
        "aliases": ["geomancer", "meepwn"]
    },
    "npc_dota_hero_axe": {
        "name": "Axe",
        "aliases": []
    },
    "npc_dota_hero_earthshaker": {
        "name": "Earthshaker",
        "aliases": ["es", "shaker"]
    },
    "npc_dota_hero_techies": {
        "name": "Techies",
        "aliases": []
    },
    "npc_dota_hero_juggernaut": {
        "name": "Juggernaut",
        "aliases": []
    },
    "npc_dota_hero_visage": {
        "name": "Visage",
        "aliases": ["visage"]
    },
    "npc_dota_hero_furion": {
        "name": "Nature's Prophet",
        "aliases": ["np", "prophet", "furion"]
    },
    "npc_dota_hero_ancient_apparition": {
        "name": "Ancient Apparition",
        "aliases": ["aa", "appa"]
    },
    "npc_dota_hero_chaos_knight": {
        "name": "Chaos Knight",
        "aliases": ["ck"]
    },
    "npc_dota_hero_spirit_breaker": {
        "name": "Spirit Breaker",
        "aliases": ["sb"]
    },
    "npc_dota_hero_beastmaster": {
        "name": "Beastmaster",
        "aliases": ["bm"]
    },
    "npc_dota_hero_phantom_lancer": {
        "name": "Phantom Lancer",
        "aliases": ["pl"]
    },
    "npc_dota_hero_abaddon": {
        "name": "Abaddon",
        "aliases": ["Abaddon"]
    },
    "npc_dota_hero_jakiro": {
        "name": "Jakiro",
        "aliases": []
    },
    "npc_dota_hero_ember_spirit": {
        "name": "Ember Spirit",
        "aliases": ["xin", "ember", "es"]
    },
    "npc_dota_hero_alchemist": {
        "name": "Alchemist",
        "aliases": []
    },
    "npc_dota_hero_pudge": {
        "name": "Pudge",
        "aliases": []
    },
    "npc_dota_hero_omniknight": {
        "name": "Omniknight",
        "aliases": []
    },
    "npc_dota_hero_terrorblade": {
        "name": "Terrorblade",
        "aliases": ["tb"]
    },
    "npc_dota_hero_warlock": {
        "name": "Warlock",
        "aliases": []
    },
    "npc_dota_hero_storm_spirit": {
        "name": "Storm Spirit",
        "aliases": ["ss"]
    },
    "npc_dota_hero_troll_warlord": {
        "name": "Troll Warlord",
        "aliases": ["troll", "jahrakal"]
    },
    "npc_dota_hero_clinkz": {
        "name": "Clinkz",
        "aliases": []
    },
    "npc_dota_hero_night_stalker": {
        "name": "Night Stalker",
        "aliases": ["ns"]
    },
    "npc_dota_hero_slardar": {
        "name": "Slardar",
        "aliases": []
    },
    "npc_dota_hero_queenofpain": {
        "name": "Queen of Pain",
        "aliases": ["qop"]
    },
    "npc_dota_hero_zuus": {
        "name": "Zeus",
        "aliases": ["zuus"]
    },
    "npc_dota_hero_dazzle": {
        "name": "Dazzle",
        "aliases": []
    },
    "npc_dota_hero_dragon_knight": {
        "name": "Dragon Knight",
        "aliases": ["dk"]
    },
    "npc_dota_hero_phantom_assassin": {
        "name": "Phantom Assassin",
        "aliases": ["pa", "mortred"]
    },
    "npc_dota_hero_windrunner": {
        "name": "Windranger",
        "aliases": ["wr", "alleria", "lyralei", "windrunner"]
    },
    "npc_dota_hero_riki": {
        "name": "Riki",
        "aliases": []
    },
    "npc_dota_hero_tusk": {
        "name": "Tusk",
        "aliases": ["tuskarr"]
    },
    "npc_dota_hero_spectre": {
        "name": "Spectre",
        "aliases": ["mercurial"]
    },
    "npc_dota_hero_bristleback": {
        "name": "Bristleback",
        "aliases": ["rigwarl", "bb"]
    },
    "npc_dota_hero_chen": {
        "name": "Chen",
        "aliases": []
    },
    "npc_dota_hero_witch_doctor": {
        "name": "Witch Doctor",
        "aliases": ["wd"]
    },
    "npc_dota_hero_sand_king": {
        "name": "Sand King",
        "aliases": ["sk"]
    },
    "npc_dota_hero_lina": {
        "name": "Lina",
        "aliases": []
    },
    "npc_dota_hero_phoenix": {
        "name": "Phoenix",
        "aliases": ["ph"]
    },
    "npc_dota_hero_slark": {
        "name": "Slark",
        "aliases": ["slark"]
    },
    "npc_dota_hero_gyrocopter": {
        "name": "Gyrocopter",
        "aliases": []
    },
    "npc_dota_hero_crystal_maiden": {
        "name": "Crystal Maiden",
        "aliases": ["cm"]
    },
    "npc_dota_hero_broodmother": {
        "name": "Broodmother",
        "aliases": ["bm"]
    },
    "npc_dota_hero_silencer": {
        "name": "Silencer",
        "aliases": []
    },
    "npc_dota_hero_earth_spirit": {
        "name": "Earth Spirit",
        "aliases": ["kaolin", "earth", "es"]
    },
    "npc_dota_hero_disruptor": {
        "name": "Disruptor",
        "aliases": ["disruptor"]
    },
    "npc_dota_hero_faceless_void": {
        "name": "Faceless Void",
        "aliases": ["fv", "void"]
    },
    "npc_dota_hero_ogre_magi": {
        "name": "Ogre Magi",
        "aliases": ["om", "magi"]
    },
    "npc_dota_hero_abyssal_underlord": {
        "name": "Underlord",
        "aliases": ["abyssal", "pitlord"]
    },
    "npc_dota_hero_monkey_king": {
        "name": "Monkey King",
        "aliases": ["mk", "monkey"]
    },
    "npc_dota_hero_dark_willow": {
        "name": "Dark Willow",
        "aliases": ["dw", "willow"]
    },
    "npc_dota_hero_pangolier": {
        "name": "Pangolier",
        "aliases": ["panlin", "armadillo"]
    }
}

var heroes = [];
for (var k in heroAliases) {
    if (heroAliases.hasOwnProperty(k)) {
        heroes.push(k);
    }
}

var selectedHero;
var searchTerm = $("#SearchTextbox").text || "";
var poll = false;

function startsWith(s, t) {
    return s.indexOf(t) == 0;
}

function findMatches(s) {
    var s = s.toLowerCase();
    var matches = {
        good: [],
        bad: []
    };
    for (var i = 0; i < heroes.length; i++) {
        var k = heroes[i];
        if (startsWith(heroAliases[k].name.toLowerCase(), s) || heroAliases[k].aliases.indexOf(s) != -1) {
            matches.good.push(k);
        }
        else {
            matches.bad.push(k);
        }
    }
    return matches;
}

function ResetDropDown() {
    $("#SearchTextbox").text = "";
    searchTerm = $("#SearchTextbox").text;
    for (var i = 0; i < heroes.length; i++) {
        $("#" + heroes[i]).visible = true;
    }
    CloseDropDown();
}

function OnSearchSubmitted() {
    var matches = ProcessSearch();
    if (matches.good.length == 1) {
        OnHeroSelected(matches.good[0]);
    }
}

function ProcessSearch() {
    var matches = findMatches($("#SearchTextbox").text);
    for (var i = 0; i < matches.good.length; i++) {
        $("#" + matches.good[i]).visible = true;
    }
    for (var i = 0; i < matches.bad.length; i++) {
        $("#" + matches.bad[i]).visible = false;
    }
    return matches;
}

function OnClick(e) {
    OnHeroSelected(e);
}

function PollSearch() {
    if (poll) {
        if (searchTerm != $("#SearchTextbox").text) {
            searchTerm = $("#SearchTextbox").text;
            ProcessSearch();
        }
        $.Schedule(.25, PollSearch);
    }
}

function OpenDropdown() {
    $('#CustomDropDown').visible = true;
    $('#CustomDropDown').ScrollToTop();
    $('#SearchTextbox').visible = true;
    $("#SearchTextbox").SetFocus();
    if (!poll) {
        poll = true;
        PollSearch();
    }
}

function CloseDropDown() {
    $('#CustomDropDown').visible = false;
    $('#SearchTextbox').visible = false;
    poll = false;
    _CustomDropdown.OpenFor = null;
    if (_CustomDropdown.OnClose) {
        _CustomDropdown.OnClose();
    }
}

function LoseFocus() {
    CloseDropDown();
}

function OnHeroSelected(e) {
    var selectedHero = e;
    //$("#SelectedHero").text = heroAliases[e].name;
    ResetDropDown();
    if (_CustomDropdown.OnHeroSelected) {
        _CustomDropdown.OnHeroSelected(e, heroAliases[e].name);
    }
}

function GetAbsoluteOffset(root, panel, x, y) {
    var x = x || 0;
    var y = y || 0;
    if (root == panel) {
        return {
            x: x + panel.actualxoffset,
            y: y + panel.actualyoffset
        }
    }
    else {
        return GetAbsoluteOffset(root, panel.GetParent(), x + panel.actualxoffset, y + panel.actualyoffset)
    }
}

var _CustomDropDown;

(function () {
    $('#CustomDropDown').visible = false;
    $('#SearchTextbox').visible = false;
    
    function CustomDropDown() {
        this.panel = $.GetContextPanel();
    }
    CustomDropDown.prototype.SetX = function (v) {
        this.panel.style.x = v.toString() + "px";
    }
    CustomDropDown.prototype.SetY = function (v) {
        this.panel.style.y = v.toString() + "px";
    }
    CustomDropDown.prototype.SetPos = function (pos) {
        this.SetX(pos.x);
        this.SetY(pos.y);
    }
    CustomDropDown.prototype.SetXY = function (x, y) {
        this.SetX(x);
        this.SetY(y);
    }
    CustomDropDown.prototype.Open = OpenDropdown;
    CustomDropDown.prototype.Close = CloseDropDown;
    CustomDropDown.prototype.GetAbsoluteOffset = GetAbsoluteOffset;
    CustomDropDown.prototype.heroAliases = heroAliases;
    
    _CustomDropdown = new CustomDropDown();
    GameUI.CustomUIConfig().CustomDropDown = _CustomDropdown;
    GameUI.CustomUIConfig().CustomDropDown.SetXY(200, 200);
})();